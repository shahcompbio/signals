<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single Cell Haplotype copy Number Analysis through Phased Probabilistic States • schnapps</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Single Cell Haplotype copy Number Analysis through Phased Probabilistic States">
<meta property="og:description" content="schnapps (Single Cell Haplotype copy Number Analysis through Phased Probabilistic States) 
    is a tool to estimate allele and haplotype specific copy number states in single cells with low coverage (~0.01X). 
    schnapps phases alleles based on losses and gains across all cells and then assigns allele specific states for each bin 
    in each cell using a hidden markov model.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">schnapps</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/ASCN-RNA.html">Allele Specific Copy Number Inference in scRNAseq</a>
    </li>
    <li>
      <a href="articles/ASCN.html">Allele Specific Copy Number Inference</a>
    </li>
    <li>
      <a href="articles/BetaBinom.html">Beta-Binomial model for schnapps</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="schnapps" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#schnapps" class="anchor"></a>schnapps</h1></div>
<!-- badges: start -->

<p>schnapps (Single Cell Haplotype copy Number Analysis through Phased Probabilistic States) is a tool to estimate allele and haplotype specific copy number states in single cells with low coverage (0.01-0.1X). schnapps phases alleles based on losses and gains across all cells and then assigns allele specific states for each bin in each cell using a hidden markov model. Documentation is available <a href="https://shahcompbio.github.io/schnapps/">here</a>.</p>
<p>You can read more about schnapps in our <a href="https://www.biorxiv.org/content/10.1101/2021.06.04.447031v1">preprint</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install schnapps with the following command</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"shahcompbio/schnapps"</span><span class="op">)</span></code></pre></div>
</div>
<div id="input-data" class="section level2">
<h2 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input data</h2>
<p><code>schnapps</code> was developed to work with Direct Library Preperation + (DLP+) data. A high throughput single cell whole genome sequencing workflow, described in <a href="https://www.sciencedirect.com/science/article/pii/S0092867419311766">Laks et al.</a>. As such it works using the output of the the pipeline developed to process this type of data, available <a href="https://github.com/shahcompbio/single_cell_pipeline">here</a>. Despite being developed with this type of data and pipeline in mind, it should work well with other single cell whole genome technologies. We have run it succesfully with 10X CNV data for example. The required inputs are total copy number estimates in bins across the genome and haplotype block counts per cell (SNP counts may also work). See the test datasets provided with the package for example inputs. If you have a different type of technology and would like some advice or help running schnapps please open an issue. We describe in more detail the necessary input below.</p>
<div id="dlp-data" class="section level3">
<h3 class="hasAnchor">
<a href="#dlp-data" class="anchor"></a>DLP+ data</h3>
<p>You will need the HMM copy results table (<code>CNbins</code>) with the following columns: <code>chr</code>, <code>start</code>,<code>end</code>, <code>cell_id</code>, <code>state</code>, <code>copy</code>. <code>state</code> is the inferred total copy number state. <code>copy</code> values are GC-correceted, ploidy corrected normalized read counts (this is what HMMcopy uses to infer the total copy number states). You will also need the cell specific haplotype counts (<code>allele_data</code>) as outputted by the <code>inferhaps</code> and <code>couthaps</code> sub commands in the pipeline. This includes the following columns: <code>chr</code>, <code>start</code>,<code>end</code>, <code>cell_id</code>, <code>hap_label</code>, <code>allele_id</code>, <code>readcount</code>. <code>allele_id</code> identifies the 2 alleles. <code>hap_label</code> is a label given to the haplotype block, these labels are consistent across cells, and in combination with <code>chr</code> gives each block a unique ID. These blocks are computed by finding SNP’s that can be confidently phased together. See the section of “phasing uncertainty” in SHAPEIT <a href="https://mathgen.stats.ox.ac.uk/genetics_software/shapeit/shapeit.html#uncertainty">here</a>. This notion of phasing uncertainty is also used in <a href="https://github.com/amcpherson/remixt">remixt</a>. Note that this notion of haplotype block is different to other tools such as CHISEL where it is assumed that the the phasing remains consistent over seem specified length such as 50kb. Finally the <code>readcount</code> columns gives the sum of the number of reads for each allele in each block.</p>
</div>
<div id="other-technologies" class="section level3">
<h3 class="hasAnchor">
<a href="#other-technologies" class="anchor"></a>Other technologies</h3>
<p>Other technologies and software should also be compatible with schnapps. For example, we have used 10X data successfully. If you have single cell bam files or fastq files see the detailed documentation for running our single cell pipeline <a href="https://github.com/shahcompbio/single_cell_pipeline/blob/master/docs/source/install.md">here</a>. Alternatively, we provide a lightweight snakemake pipeline with the key steps <a href="https://github.com/marcjwilliams1/hscn_pipeline">here</a>. Also included there are some scripts to demultiplex 10X CNV bams.</p>
<p>If you total copy number calls from other software such as 10X cellranger or <a href="https://github.com/rujinwang/SCOPE">scope</a>, these may also work but not something we have tried. Feel free to open an issue if you need some advice.</p>
</div>
<div id="data-conventions" class="section level3">
<h3 class="hasAnchor">
<a href="#data-conventions" class="anchor"></a>Data conventions</h3>
<p>Some of the plotting tools assume that the <code>cell_id</code>’s conform to the following naming conventions</p>
<pre><code>{sample}-{library}-{R*}-{C*}</code></pre>
<p>Here R and C refer the rows and columns on the chip. If you’re using another technology and your cells are named differently, we would reccomend renaming your cell’s for easy compatability. For example, if you have 10X data where cell_id’s are barcodes that look like <code>CCGTACTTCACGGTAT-1</code> something like this would work</p>
<pre class="{r}"><code>new_cell_id &lt;- paste("mysample", "mylibrary", "CCGTACTTCACGGTAT-1", sep = "-")</code></pre>
<p>It is imortant to have 4 string’s seperated by “-”, but the unique cell identifier should be one of the last 2 strings for the heatmap labelling to format nicely.</p>
</div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Here we’ll show an example of running schnapps with a small dataset of 250 cells from the DLP platform. First we need to do some data wrangling to convert the <code>allele_data</code> table from long to wide format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">schnapps</span><span class="op">)</span>
<span class="va">haplotypes</span><span class="op">&lt;-</span> <span class="fu">format_haplotypes_dlp</span><span class="op">(</span><span class="va">haplotypes</span>, <span class="va">CNbins</span><span class="op">)</span></code></pre></div>
<p>Then we can call haplotype specific state per cell:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hscn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/callHaplotypeSpecificCN.html">callHaplotypeSpecificCN</a></span><span class="op">(</span><span class="va">CNbins</span>, <span class="va">haplotypes</span><span class="op">)</span></code></pre></div>
<p>Or alternatively allele specific states:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hscn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/callAlleleSpecificCN.html">callAlleleSpecificCN</a></span><span class="op">(</span><span class="va">CNbins</span>, <span class="va">haplotypes</span><span class="op">)</span></code></pre></div>
<p>See the vignette for more information on the differences between these two outputs.</p>
<p>After performing this inference, to QC the results it is useful to plot a different representation of the BAF. Here we plot the BAF as a function of the inferred states. The black lines indicate where we should see the mean BAF based on the state.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plotBAFperstate.html">plotBAFperstate</a></span><span class="op">(</span><span class="va">ascn</span>, maxstate <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>After having ensured the results make sense, you can plot a heatmap of the states across all cells with the following.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/plotHeatmap.html">plotHeatmap</a></span><span class="op">(</span><span class="va">ascn</span>, plotcol <span class="op">=</span> <span class="st">"state_BAF"</span><span class="op">)</span></code></pre></div>
<p>This will cluster the cell using umap and hdbscan.</p>
<p><code>schnapps</code> includes a number of other utilities for analysing single cell (haplotype-specific) copy number including the following:</p>
<ul>
<li>integration with scRNAseq using <a href="https://satijalab.org/seurat/index.html">seurat</a>
</li>
<li>extensive plotting functions</li>
<li>integration and plotting with structural variants</li>
<li>clustering</li>
<li>utilities such as consensus copy number in cell clusters and arm level changes etc</li>
</ul>
<p>Please see the vignettes for more information.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Marc J Williams <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/shahcompbio/schnapps/actions"><img src="https://github.com/shahcompbio/schnapps/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/shahcompbio/schnapps?branch=master"><img src="https://codecov.io/gh/shahcompbio/schnapps/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://hub.docker.com/repository/docker/marcjwilliams1/schnapps"><img src="https://img.shields.io/docker/cloud/build/marcjwilliams1/schnapps" alt="Docker"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Marc J Williams.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
